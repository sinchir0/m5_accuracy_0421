[LightGBM] [Info] Total Bins 3971
[LightGBM] [Info] Number of data: 29973650, number of used features: 34
[LightGBM] [Info] Start training from score 1.218203
Start load_datasets_and_target
Mem. usage decreased to 4501.80 Mb (41.6% reduction)
Finish
                                       id          item_id      dept_id     cat_id  ... 004_month 004_week  004_day 004_dayofweek
0         HOUSEHOLD_1_514_WI_3_validation  HOUSEHOLD_1_514  HOUSEHOLD_1  HOUSEHOLD  ...         7       29       18             3
1         HOUSEHOLD_1_515_WI_3_validation  HOUSEHOLD_1_515  HOUSEHOLD_1  HOUSEHOLD  ...         7       29       18             3
2         HOUSEHOLD_1_516_WI_3_validation  HOUSEHOLD_1_516  HOUSEHOLD_1  HOUSEHOLD  ...         7       29       18             3
3         HOUSEHOLD_1_517_WI_3_validation  HOUSEHOLD_1_517  HOUSEHOLD_1  HOUSEHOLD  ...         7       29       18             3
4         HOUSEHOLD_1_518_WI_3_validation  HOUSEHOLD_1_518  HOUSEHOLD_1  HOUSEHOLD  ...         7       29       18             3
...                                   ...              ...          ...        ...  ...       ...      ...      ...           ...
29973645      FOODS_3_823_WI_3_validation      FOODS_3_823      FOODS_3      FOODS  ...         3       12       27             6
29973646      FOODS_3_824_WI_3_validation      FOODS_3_824      FOODS_3      FOODS  ...         3       12       27             6
29973647      FOODS_3_825_WI_3_validation      FOODS_3_825      FOODS_3      FOODS  ...         3       12       27             6
29973648      FOODS_3_826_WI_3_validation      FOODS_3_826      FOODS_3      FOODS  ...         3       12       27             6
29973649      FOODS_3_827_WI_3_validation      FOODS_3_827      FOODS_3      FOODS  ...         3       12       27             6

[29973650 rows x 38 columns]
                                     id        item_id    dept_id   cat_id  ... 004_month 004_week  004_day 004_dayofweek
29973650  HOBBIES_1_001_CA_1_validation  HOBBIES_1_001  HOBBIES_1  HOBBIES  ...         3       13       28             0
29973651  HOBBIES_1_002_CA_1_validation  HOBBIES_1_002  HOBBIES_1  HOBBIES  ...         3       13       28             0
29973652  HOBBIES_1_003_CA_1_validation  HOBBIES_1_003  HOBBIES_1  HOBBIES  ...         3       13       28             0
29973653  HOBBIES_1_004_CA_1_validation  HOBBIES_1_004  HOBBIES_1  HOBBIES  ...         3       13       28             0
29973654  HOBBIES_1_005_CA_1_validation  HOBBIES_1_005  HOBBIES_1  HOBBIES  ...         3       13       28             0
...                                 ...            ...        ...      ...  ...       ...      ...      ...           ...
30827365    FOODS_3_823_WI_3_validation    FOODS_3_823    FOODS_3    FOODS  ...         4       16       24             6
30827366    FOODS_3_824_WI_3_validation    FOODS_3_824    FOODS_3    FOODS  ...         4       16       24             6
30827367    FOODS_3_825_WI_3_validation    FOODS_3_825    FOODS_3    FOODS  ...         4       16       24             6
30827368    FOODS_3_826_WI_3_validation    FOODS_3_826    FOODS_3    FOODS  ...         4       16       24             6
30827369    FOODS_3_827_WI_3_validation    FOODS_3_827    FOODS_3    FOODS  ...         4       16       24             6

[853720 rows x 38 columns]
                                     id        item_id    dept_id   cat_id  ... 004_month 004_week  004_day 004_dayofweek
30827370  HOBBIES_1_001_CA_1_validation  HOBBIES_1_001  HOBBIES_1  HOBBIES  ...         4       17       25             0
30827371  HOBBIES_1_002_CA_1_validation  HOBBIES_1_002  HOBBIES_1  HOBBIES  ...         4       17       25             0
30827372  HOBBIES_1_003_CA_1_validation  HOBBIES_1_003  HOBBIES_1  HOBBIES  ...         4       17       25             0
30827373  HOBBIES_1_004_CA_1_validation  HOBBIES_1_004  HOBBIES_1  HOBBIES  ...         4       17       25             0
30827374  HOBBIES_1_005_CA_1_validation  HOBBIES_1_005  HOBBIES_1  HOBBIES  ...         4       17       25             0
...                                 ...            ...        ...      ...  ...       ...      ...      ...           ...
31681085    FOODS_3_823_WI_3_validation    FOODS_3_823    FOODS_3    FOODS  ...         5       20       22             6
31681086    FOODS_3_824_WI_3_validation    FOODS_3_824    FOODS_3    FOODS  ...         5       20       22             6
31681087    FOODS_3_825_WI_3_validation    FOODS_3_825    FOODS_3    FOODS  ...         5       20       22             6
31681088    FOODS_3_826_WI_3_validation    FOODS_3_826    FOODS_3    FOODS  ...         5       20       22             6
31681089    FOODS_3_827_WI_3_validation    FOODS_3_827    FOODS_3    FOODS  ...         5       20       22             6

[853720 rows x 38 columns]
Start lgb_model
Start HOLD_OUT
Start auto_label_encoder
Finish
Start OUTPUT_USE_DF
Finish
Training until validation scores don't improve for 50 rounds
[100]	training's rmse: 2.38689	valid_1's rmse: 2.14105
[200]	training's rmse: 2.33452	valid_1's rmse: 2.13259
Early stopping, best iteration is:
[211]	training's rmse: 2.33044	valid_1's rmse: 2.13199
train_2.330442253456186
valid_2.13198686411904
RMSSE score train : train_2.330442253456186, valid : valid_2.13198686411904
RMSSE score train : train_2.330442253456186, valid : valid_2.13198686411904
                      feature  importance
34                 sell_price         510
3         002_rolling_mean_t7         477
20                    item_id         429
26                   wm_yr_wk         409
5        002_rolling_mean_t30         405
17                   004_week         404
0                 001_lag_t28         288
14  003_rolling_price_std_t30         274
9        002_rolling_skew_t30         265
7       002_rolling_mean_t180         261
23                   store_id         250
6        002_rolling_mean_t90         246
18                    004_day         241
19              004_dayofweek         232
16                  004_month         226
10       002_rolling_kurt_t30         223
2                 001_lag_t30         202
1                 001_lag_t29         196
12      003_price_change_t365         140
4          002_rolling_std_t7         134
8         002_rolling_std_t30         109
13   003_rolling_price_std_t7          81
24                   state_id          79
21                    dept_id          52
33                    snap_WI          48
27               event_name_1          40
15                   004_year          34
28               event_type_1          22
32                    snap_TX          21
11        003_price_change_t1          14
31                    snap_CA          10
22                     cat_id           7
30               event_type_2           1
25                       part           0
29               event_name_2           0
Finish
Start make submission
                                     id        date    demand
30827370  HOBBIES_1_001_CA_1_validation  2016-04-25  0.920607
30827371  HOBBIES_1_002_CA_1_validation  2016-04-25  0.410369
30827372  HOBBIES_1_003_CA_1_validation  2016-04-25  0.434319
30827373  HOBBIES_1_004_CA_1_validation  2016-04-25  1.788730
30827374  HOBBIES_1_005_CA_1_validation  2016-04-25  0.928532
...                                 ...         ...       ...
31681085    FOODS_3_823_WI_3_validation  2016-05-22  0.465364
31681086    FOODS_3_824_WI_3_validation  2016-05-22  0.330974
31681087    FOODS_3_825_WI_3_validation  2016-05-22  0.919958
31681088    FOODS_3_826_WI_3_validation  2016-05-22  1.521181
31681089    FOODS_3_827_WI_3_validation  2016-05-22  1.375936

[853720 rows x 3 columns]
date                                id  2016-04-25  2016-04-26  2016-04-27  ...  2016-05-19  2016-05-20  2016-05-21  2016-05-22
0          FOODS_1_001_CA_1_validation    0.837653    0.712468    0.694305  ...    0.860171    0.937919    1.091814    1.076490
1          FOODS_1_001_CA_2_validation    0.775444    0.743982    0.741151  ...    1.483322    1.484093    1.631174    1.335476
2          FOODS_1_001_CA_3_validation    1.172983    1.100345    1.106974  ...    1.009218    1.024211    1.356218    1.091010
3          FOODS_1_001_CA_4_validation    0.450404    0.356675    0.337087  ...    0.205425    0.280044    0.397256    0.461799
4          FOODS_1_001_TX_1_validation    0.566374    0.534911    0.509625  ...    0.264036    0.298080    0.349076    0.349076
...                                ...         ...         ...         ...  ...         ...         ...         ...         ...
30485  HOUSEHOLD_2_516_TX_2_validation    0.252299    0.220837    0.244223  ...    0.237071    0.271115    0.312652    0.265510
30486  HOUSEHOLD_2_516_TX_3_validation    0.112340    0.156974    0.171008  ...    0.284905    0.398955    0.449951    0.449951
30487  HOUSEHOLD_2_516_WI_1_validation    0.101956    0.070494    0.067663  ...    0.127137    0.102444    0.153439    0.153439
30488  HOUSEHOLD_2_516_WI_2_validation    0.101956    0.070494    0.067663  ...    0.136596    0.149895    0.194946    0.194946
30489  HOUSEHOLD_2_516_WI_3_validation    0.099683    0.068220    0.065390  ...    0.077412    0.100170    0.162534    0.162534

[30490 rows x 29 columns]Found `num_boost_round` in params. Will use it instead of argument
Found `early_stopping_rounds` in params. Will use it instead of argument

Finish case1! I kept you waiting !
Quick submit command
python submit_m5_acc.py sub_case1_20200329123501_valid_2.13198686411904.csv comment
Start load_datasets_and_target
Traceback (most recent call last):
  File "run.py", line 16, in <module>
    train_df,valid_df,test_df,X_train,y_train,X_valid,y_valid = load_datasets_and_target(FEATURE,TARGET)
  File "/home/jupyter/kaggle_pipeline_m5_accuracy/utils/__init__.py", line 43, in load_datasets_and_target
    data_not_concat = pd.read_pickle(f"{DATA_PATH}/data.pkl")
  File "/opt/conda/lib/python3.7/site-packages/pandas/io/pickle.py", line 170, in read_pickle
    f, fh = get_handle(fp_or_buf, "rb", compression=compression, is_text=False)
  File "/opt/conda/lib/python3.7/site-packages/pandas/io/common.py", line 434, in get_handle
    f = open(path_or_buf, mode)
FileNotFoundError: [Errno 2] No such file or directory: '/home/jupyter/kaggle_pipeline_m5_accuracy/data/input/data.pkl'
[LightGBM] [Fatal] Cannot write binary data to /home/jupyter/kaggle_pipeline_m5_accuracy/model_output/case1/case1_20200404070646_train.bin 
Start load_datasets_and_target
Mem. usage decreased to 8702.56 Mb (46.1% reduction)
Finish
                                       id  item_id  dept_id  cat_id  store_id  ...  004_year  004_month  004_week 004_day  004_dayofweek
0         HOUSEHOLD_1_514_WI_3_validation        0        0       0         0  ...      2011          1         4      29              5
1         HOUSEHOLD_1_515_WI_3_validation        1        0       0         0  ...      2011          1         4      29              5
2         HOUSEHOLD_1_516_WI_3_validation        2        0       0         0  ...      2011          1         4      29              5
3         HOUSEHOLD_1_517_WI_3_validation        3        0       0         0  ...      2011          1         4      29              5
4         HOUSEHOLD_1_518_WI_3_validation        4        0       0         0  ...      2011          1         4      29              5
...                                   ...      ...      ...     ...       ...  ...       ...        ...       ...     ...            ...
29973645      FOODS_3_823_WI_3_validation     1975        4       1         0  ...      2013         10        41       8              1
29973646      FOODS_3_824_WI_3_validation     1976        4       1         0  ...      2013         10        41       8              1
29973647      FOODS_3_825_WI_3_validation     1977        4       1         0  ...      2013         10        41       8              1
29973648      FOODS_3_826_WI_3_validation     1978        4       1         0  ...      2013         10        41       8              1
29973649      FOODS_3_827_WI_3_validation     1979        4       1         0  ...      2013         10        41       8              1

[29973650 rows x 38 columns]
                                     id  item_id  dept_id  cat_id  store_id  ...  004_year  004_month  004_week 004_day  004_dayofweek
29973650  HOBBIES_1_001_CA_1_validation     1980        5       2         1  ...      2013         10        41       8              1
29973651  HOBBIES_1_002_CA_1_validation     1981        5       2         1  ...      2013         10        41       8              1
29973652  HOBBIES_1_003_CA_1_validation     1982        5       2         1  ...      2013         10        41       8              1
29973653  HOBBIES_1_004_CA_1_validation     1983        5       2         1  ...      2013         10        41       8              1
29973654  HOBBIES_1_005_CA_1_validation     1984        5       2         1  ...      2013         10        41       8              1
...                                 ...      ...      ...     ...       ...  ...       ...        ...       ...     ...            ...
30827365    FOODS_3_823_WI_3_validation     1975        4       1         0  ...      2013         11        45       5              1
30827366    FOODS_3_824_WI_3_validation     1976        4       1         0  ...      2013         11        45       5              1
30827367    FOODS_3_825_WI_3_validation     1977        4       1         0  ...      2013         11        45       5              1
30827368    FOODS_3_826_WI_3_validation     1978        4       1         0  ...      2013         11        45       5              1
30827369    FOODS_3_827_WI_3_validation     1979        4       1         0  ...      2013         11        45       5              1

[853720 rows x 38 columns]
                                     id  item_id  dept_id  cat_id  store_id  ...  004_year  004_month  004_week 004_day  004_dayofweek
30827370  HOBBIES_1_001_CA_1_validation     1980        5       2         1  ...      2013         11        45       5              1
30827371  HOBBIES_1_002_CA_1_validation     1981        5       2         1  ...      2013         11        45       5              1
30827372  HOBBIES_1_003_CA_1_validation     1982        5       2         1  ...      2013         11        45       5              1
30827373  HOBBIES_1_004_CA_1_validation     1983        5       2         1  ...      2013         11        45       5              1
30827374  HOBBIES_1_005_CA_1_validation     1984        5       2         1  ...      2013         11        45       5              1
...                                 ...      ...      ...     ...       ...  ...       ...        ...       ...     ...            ...
31681085    FOODS_3_823_WI_3_validation     1975        4       1         0  ...      2013         12        49       3              1
31681086    FOODS_3_824_WI_3_validation     1976        4       1         0  ...      2013         12        49       3              1
31681087    FOODS_3_825_WI_3_validation     1977        4       1         0  ...      2013         12        49       3              1
31681088    FOODS_3_826_WI_3_validation     1978        4       1         0  ...      2013         12        49       3              1
31681089    FOODS_3_827_WI_3_validation     1979        4       1         0  ...      2013         12        49       3              1

[853720 rows x 38 columns]
Start lgb_model
Start HOLD_OUT
Finish
Traceback (most recent call last):
  File "run.py", line 42, in <module>
    valid_df = valid_df
  File "/home/jupyter/kaggle_pipeline_m5_accuracy/models/Base_Model.py", line 37, in __init__
    self.y_pred, self.score, self.model = self.fit_hold()
  File "/home/jupyter/kaggle_pipeline_m5_accuracy/models/Base_Model.py", line 217, in fit_hold
    train_set, val_set = self.convert_dataset(x_train, y_train, x_val, y_val)
  File "/home/jupyter/kaggle_pipeline_m5_accuracy/models/lgbm.py", line 30, in convert_dataset
    train_set.save_binary(f'{MODEL_PASS}/{CASE}/{CASE}_{NOW:%Y%m%d%H%M%S}_train.bin')
  File "/opt/conda/lib/python3.7/site-packages/lightgbm/basic.py", line 1164, in save_binary
    c_str(filename)))
  File "/opt/conda/lib/python3.7/site-packages/lightgbm/basic.py", line 45, in _safe_call
    raise LightGBMError(decode_string(_LIB.LGBM_GetLastError()))
lightgbm.basic.LightGBMError: Cannot write binary data to /home/jupyter/kaggle_pipeline_m5_accuracy/model_output/case1/case1_20200404070646_train.bin 
